<div class="wave-container" style="height: {{ section.settings.container_height }}px;">
  <canvas id="waveCanvas-{{ section.id }}"></canvas>
</div>

<style>
.wave-container {
  position: relative;
  width: 100vw;
  left: 50%;
  margin-left: -50vw;
  overflow: hidden;
}
canvas#waveCanvas-{{ section.id }} {
  display: block;
  width: 100vw;
  height: 100%;
}
</style>

<script>
(function(){
  const canvas = document.getElementById('waveCanvas-{{ section.id }}');
  if (!canvas) return;

  const ctx = canvas.getContext('2d');

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = canvas.parentElement.offsetHeight;
  }
  window.addEventListener('resize', resizeCanvas);
  resizeCanvas();

  function hexToRgba(hex, opacity) {
    hex = hex.replace('#', '');
    const r = parseInt(hex.substring(0, 2), 16);
    const g = parseInt(hex.substring(2, 4), 16);
    const b = parseInt(hex.substring(4, 6), 16);
    return `rgba(${r}, ${g}, ${b}, ${opacity})`;
  }

  const waves = [
    { color: hexToRgba('{{ section.settings.wave_color_1 }}', {{ section.settings.wave_opacity_1 }} / 100), direction: 1 },
    { color: hexToRgba('{{ section.settings.wave_color_2 }}', {{ section.settings.wave_opacity_2 }} / 100), direction: -1 },
    { color: hexToRgba('{{ section.settings.wave_color_3 }}', {{ section.settings.wave_opacity_3 }} / 100), direction: 1 },
    { color: hexToRgba('{{ section.settings.wave_color_4 }}', {{ section.settings.wave_opacity_4 }} / 100), direction: -1 }
  ];

  const baseSettings = {
    amplitude: {{ section.settings.wave_amplitude }},
    wavelength: {{ section.settings.wave_wavelength }},
    speed: {{ section.settings.wave_speed }} / 100
  };

  waves.forEach(wave => {
    wave.amplitude = baseSettings.amplitude * (0.8 + Math.random() * 0.4);
    wave.wavelength = baseSettings.wavelength * (0.8 + Math.random() * 0.4);
    wave.speed = baseSettings.speed * (0.8 + Math.random() * 0.4);
    wave.phase = Math.random() * Math.PI * 2;
  });

  let t = 0;

  function drawWaves() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    waves.forEach(wave => {
      ctx.beginPath();
      for (let x = 0; x <= canvas.width; x++) {
        const y =
          canvas.height / 2 +
          wave.amplitude * Math.sin((x / wave.wavelength) * 2 * Math.PI + t * wave.speed * wave.direction + wave.phase) +
          Math.sin(x / 100 + t * 0.01) * wave.amplitude * 0.3;

        x === 0 ? ctx.moveTo(x, y) : ctx.lineTo(x, y);
      }
      ctx.lineTo(canvas.width, canvas.height);
      ctx.lineTo(0, canvas.height);
      ctx.closePath();
      ctx.fillStyle = wave.color;
      ctx.fill();
    });

    t += 1;
    requestAnimationFrame(drawWaves);
  }

  drawWaves();
})();
</script>
